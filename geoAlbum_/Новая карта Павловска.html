<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Павловский парк</title>
</head>

<body>
    <div id="map_Pavlovsk" style="width:100%; height:600px"></div>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
    <script id="data" src="Павловск.json" type="application/json"></script>
    <script type="text/javascript">
        //  Создание карты в leaflet
        var geoMap = L.map('map_Pavlovsk', { scrollWheelZoom: false }).setView([59.6897, 30.4582], 15);
        Control = new L.Control.Layers(null, null, { collapsed: false });
        geoMap.addControl(Control);

        //  Типовая карта ОСМ
        var bl_Mapnik = L.tileLayer(
            'http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
                attribution: '&copy; участники <a href="http://osm.org/copyright">OpenStreetMap</a>'
            });
        Control.addBaseLayer(bl_Mapnik, "Мапник ОСМ");
        bl_Mapnik.addTo(geoMap); // Назначается картой по умолчанию

        // Топографическая карта OpenTopoMap
        var bl_Topo = L.tileLayer(
            'https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
                maxZoom: 17,
                attribution: 'Map data: {attribution.OpenStreetMap}, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'
            });
        Control.addBaseLayer(bl_Topo, "Топографическая карта");
        // Спутниковые снимки
        var Esri_WorldImagery = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
        });
        Control.addBaseLayer(Esri_WorldImagery, "Спутниковые снимки от ESRI");
        // Карта пешехода
        var MtbMap = L.tileLayer('http://tile.mtbmap.cz/mtbmap_tiles/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &amp; USGS'
        });
        Control.addBaseLayer(MtbMap, "Mtb - карта пешехода");
        // Карта викимедия
        var Wikimedia = L.tileLayer('https://maps.wikimedia.org/osm-intl/{z}/{x}/{y}{r}.png', {
            attribution: '&copy участники <a href="http://osm.org/copyright">OpenStreetMap</a>, <a href="https://wikimediafoundation.org/wiki/Maps_Terms_of_Use">Wikimedia</a>',
            minZoom: 1,
            maxZoom: 19
        });
        Control.addBaseLayer(Wikimedia, "Карта Викимедия (Википедии)");
        // Ландшафтная карта
        var Thunderforest_Landscape = L.tileLayer('https://{s}.tile.thunderforest.com/landscape/{z}/{x}/{y}.png?apikey={apikey}', {
            attribution: '&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            apikey: '49968a99152345db9b0f583b014d8cc7',
            maxZoom: 22
        });
        Control.addBaseLayer(Thunderforest_Landscape, "Ландшафтная карта");
        // Карта для ориентирования
        var Orient1 = L.tileLayer('https://tiler5.oobrien.com/oterrain_global/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://oomap.co.uk">OOMAP</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            maxZoom: 22
        });
        Control.addBaseLayer(Orient1, "Карта для ориентирования");
        
        // Карта Сканэкс 1
        var OsmSp1 = L.tileLayer('http://tilessputnik.ru/{z}/{x}/{y}.png', {
            attribution: '<a target="_blank" href="http://kosmosnimki.ru/terms.html" style="" class="">© 2007-2019 RDC ScanEx</a> - Terms of Service<br><a target="_blank" href="http://maps.sputnik.ru">Спутник</a> © Ростелеком | © <a target="_blank" href="http://www.openstreetmap.org/copyright">OpenStreetMap</a><br><a target="_blank" href="http://leafletjs.com">© Leaflet</a>',
            maxZoom: 22
        });
        Control.addBaseLayer(OsmSp1, "ScanEx карта 1");
        
        // Карта Сканэкс 2
        var OsmSp2 = L.tileLayer('https://{s}tilecart.kosmosnimki.ru/kosmo/{z}/{x}/{y}.png', {
            attribution: '<a target="_blank" href="http://kosmosnimki.ru/terms.html" style="" class="">© 2007-2019 RDC ScanEx</a> - Terms of Service<br><a target="_blank" href="http://maps.sputnik.ru">Спутник</a> © Ростелеком | © <a target="_blank" href="http://www.openstreetmap.org/copyright">OpenStreetMap</a><br><a target="_blank" href="http://leafletjs.com">© Leaflet</a>',
            maxZoom: 22
        });
        Control.addBaseLayer(OsmSp2, "ScanEx карта 2");
        
        /*
        var Orient = L.tileLayer('https://tiler5.oobrien.com/streeto_global/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://oomap.co.uk">OOMAP</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',		
            maxZoom: 22
        });  
        Control.addBaseLayer(Orient, "Карта для ориентирования с упрощениями");    	
        // Карта от MapBox - в Павлвоске неудачная
        var bl_MapBox = L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw',	{
                maxZoom: 28,
                attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' + '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +	'Imagery © <a href="http://mapbox.com">Mapbox</a>',
                id: 'mapbox.streets'
                });
        Control.addBaseLayer(bl_MapBox, "MapBox"); */
        
        var dtxt = document.getElementById('data').innerHTML;
        var geo_obj = JSON.parse(dtxt);
        
        for (var i_ in geo_obj) {
            var obj = geo_obj[i_];
            var div = "<b>" + obj.title + "</b><br><img src='" + obj.img_url + "'/></br>" + obj.text + "<br><i><a target='_blank' href='" + obj.url + "'>Подробнее...</a></i>";
            var marker = L.marker(obj.geo).bindPopup(div).on('popupopen', function (e) {
                var geo = e.popup.getLatLng();
                geoMap.panTo(geo, { animate: true, duration: 0.4 });
                Control.collapse();
                var px = geoMap.project(geo);
                px.y -= e.popup.getElement().clientHeight;
                // px.y -= e.target.getElement().clientHeight;
                geoMap.panTo(geoMap.unproject(px), { animate: true });
            });
            geoMap.addLayer(marker);
        }
    </script>
</body>

</html>
